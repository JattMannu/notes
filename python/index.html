<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/python/">
        <link rel="shortcut icon" href="../toki_32.png">
        

	<title>Python - Shichao's Notes</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,400italic,500,600" rel="stylesheet">
        <link href="../custom.css" rel="stylesheet">
        <link href="../friendly.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                      
                        <li >
                            <a href="../apue/">Contents</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch3/">Chapter 3. File I/O</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch4/">Chapter 4. Files and Directories</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch5/">Chapter 5. Standard I/O Library</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch6/">Chapter 6. System Data Files and Information</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch7/">Chapter 7. Process Environment</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch8/">Chapter 8. Process Control</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch9/">Chapter 9. Process Relationships</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch10/">Chapter 10. Signals</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch11/">Chapter 11. Threads</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch12/">Chapter 12. Thread Control</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch13/">Chapter 13. Daemon Processes</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch14/">Chapter 14. Advanced I/O</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch15/">Chapter 15. Interprocess Communication</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch16/">Chapter 16. Network IPC: Sockets</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../apue/ch17/">Chapter 17. Advanced IPC</a>
                        </li>
                      
                    
                    </ul>
                </li>
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">LKD <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                      
                        <li >
                            <a href="../lkd/">Contents</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch1/">Chapter 1. Introduction to the Linux Kernel</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch2/">Chapter 2. Getting Started with the Kernel</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch3/">Chapter 3. Process Management</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch4/">Chapter 4. Process Scheduling</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch5/">Chapter 5. System Calls</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch6/">Chapter 6. Kernel Data Structures</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch7/">Chapter 7. Interrupts and Interrupt Handlers</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch8/">Chapter 8. Bottom Halves and Deferring Work</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch9/">Chapter 9. An Introduction to Kernel Synchronization</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch10/">Chapter 10. Kernel Synchronization Methods</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch11/">Chapter 11. Timers and Time Management</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch12/">Chapter 12. Memory Management</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch13/">Chapter 13. The Virtual Filesystem</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch14/">Chapter 14. The Block I/O Layer</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../lkd/ch15/">Chapter 15. The Process Address Space</a>
                        </li>
                      
                    
                    </ul>
                </li>
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                      
                        <li >
                            <a href="../unp/">Contents</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../unp/ch3/">Chapter 3. Sockets Introduction</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../unp/ch4/">Chapter 4. Elementary TCP Sockets</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../unp/ch5/">Chapter 5. TCP Client/Server Example</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../unp/ch6/">Chapter 6. I/O Multiplexing: The select and poll Functions</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../unp/ch7/">Chapter 7. Socket Options</a>
                        </li>
                      
                    
                    </ul>
                </li>
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TCPv1 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                      
                        <li >
                            <a href="../tcpv1/">Contents</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch2/">Chapter 2. The Internet Address Architecture</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch3/">Chapter 3. Link Layer</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch4/">Chapter 4. ARP: Address Resolution Protocol </a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch5/">Chapter 5. The Internet Protocol (IP)</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch6/">Chapter 6. System Configuration: DHCP and Autoconfiguration</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch7/">Chapter 7. Firewalls and Network Address Translation (NAT)</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch8/">Chapter 8. ICMPv4 and ICMPv6: Internet Control Message Protocol</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch9/">Chapter 9. Broadcasting and Local Multicasting (IGMP and MLD) </a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch10/">Chapter 10. User Datagram Protocol (UDP) and IP Fragmentation</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch11/">Chapter 11. Name Resolution and the Domain Name System (DNS)</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch12/">Chapter 12. TCP: The Transmission Control Protocol (Preliminaries)</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch13/">Chapter 13. TCP Connection Management</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch14/">Chapter 14. TCP Timeout and Retransmission</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch15/">Chapter 15. TCP Data Flow and Window Management</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch16/">Chapter 16. TCP Congestion Control</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch17/">Chapter 17. TCP Keepalive</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/ch18/">Chapter 18. Security: EAP, IPsec, TLS, DNSSEC, and DKIM</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../tcpv1/headers/">Headers</a>
                        </li>
                      
                    
                    </ul>
                </li>
            
            
            
            
            
            
            
            
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">GOPL <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                      
                        <li >
                            <a href="../gopl/">Contents</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../gopl/ch1/">Chapter 1. Tutorial</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../gopl/ch2/">Chapter 2. Program Structure</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../gopl/ch3/">Chapter 3. Basic Data Types</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../gopl/ch4/">Chapter 4. Composite Types</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../gopl/ch5/">Chapter 5. Functions</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../gopl/ch6/">Chapter 6. Methods</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../gopl/ch7/">Chapter 7. Interfaces</a>
                        </li>
                      
                    
                    </ul>
                </li>
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TWGR <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                      
                        <li >
                            <a href="../twgr/">Contents</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../twgr/ch1/">Chapter 1. Bootstrapping your Ruby literacy</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../twgr/ch2/">Chapter 2. Objects, methods, and local variables</a>
                        </li>
                      
                    
                    </ul>
                </li>
            
            
            
            
            
            
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">SPEC <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                      
                        <li >
                            <a href="../spec/">Contents</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../spec/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../spec/ch2/">Chapter 2. Methodology</a>
                        </li>
                      
                    
                      
                        <li >
                            <a href="../spec/ch3/">Chapter 3. Operating Systems</a>
                        </li>
                      
                    
                    </ul>
                </li>
            
            
            
            
            
            
            
            
            
            
            
            
            
                <li >
                    <a href="../roadmap/">Roadmap</a>
                </li>
            
            
            
            
            
            </ul>
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    
                        <a href="https://github.com/shichao-an/notes/blob/master/docs/python/index.md">
                    
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#python">Python</a></li>
        
    
        <li class="main "><a href="#a-tutorial-introduction">A Tutorial Introduction</a></li>
        
            <li><a href="#generators">Generators</a></li>
        
            <li><a href="#coroutines">Coroutines</a></li>
        
    
        <li class="main "><a href="#functions-and-functional-programming">Functions and Functional Programming</a></li>
        
            <li><a href="#decorators">Decorators</a></li>
        
    
        <li class="main "><a href="#references">References</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
              

<h3 id="python"><strong>Python</strong></h3>
<h3 id="a-tutorial-introduction">A Tutorial Introduction</h3>
<h4 id="generators">Generators</h4>
<p>Instead of returning a single value, a function can generate an entire sequence of results if it uses the <code>yield</code> statement. For example:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Counting down!&quot;</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">n</span> <span class="c"># Generate a value (n)</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>


<p>Any function that uses <code>yield</code> is known as a <strong>generator</strong>. Calling a generator function creates an object that produces a sequence of results through successive calls to a <code>next()</code> method (or <code>__next__()</code> in Python 3). For example:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">Counting down!</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">3</span>
</pre></div>


<p>The <code>next()</code> call makes a generator function run until it reaches the next <code>yield</code> statement. At this point, the value passed to <code>yield</code> is returned by <code>next()</code>, and the function suspends execution. The function resumes execution on the statement following <code>yield</code> when <code>next()</code> is called again. This process continues until the function returns.</p>
<p>Normally you would not manually call next() as shown. Instead, you hook it up to
a for loop like this:</p>
<p>Normally you would not manually call <code>next()</code> as shown. Instead, you hook it up to a <code>for</code> loop like this:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="o">...</span> <span class="k">print</span> <span class="n">i</span><span class="p">,</span>
<span class="n">Counting</span> <span class="n">down</span><span class="err">!</span>
<span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span>
</pre></div>


<p>Generators are an extremely powerful way of writing programs based on processing pipelines, streams, or data flow. For example, the following generator function mimics the behavior of the UNIX <code>tail -f</code> command that’s commonly used to monitor log files:</p>
<div class="codehilite"><pre><span class="c"># tail a file (like tail -f)</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c"># Move to EOF</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="c"># Try reading a new line of text</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="c"># If nothing, sleep briefly and try again</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">line</span>
</pre></div>


<p>Here’s an example of hooking both of these generators together to create a simple processing pipeline:</p>
<div class="codehilite"><pre><span class="c"># A python implementation of Unix &quot;tail -f | grep python&quot;</span>
<span class="n">wwwlog</span> <span class="o">=</span> <span class="n">tail</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;access-log&quot;</span><span class="p">))</span>
<span class="n">pylines</span> <span class="o">=</span> <span class="n">grep</span><span class="p">(</span><span class="n">wwwlog</span><span class="p">,</span><span class="s">&quot;python&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pylines</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">line</span><span class="p">,</span>
</pre></div>


<p>A subtle aspect of generators is that they are often mixed together with other iterable
objects such as lists or files. Specifically, when you write a statement such as <code>for item
in s</code>, <code>s</code> could represent the following:</p>
<ul>
<li>A list of items,</li>
<li>The lines of a file,</li>
<li>The result of a generator function,</li>
<li>Any number of other objects that support iteration.</li>
</ul>
<p>The fact that you can just plug different objects in for <code>s</code> can be a powerful tool for creating extensible programs.</p>
<h4 id="coroutines">Coroutines</h4>
<p>Normally, functions operate on a single set of input arguments. However, a function can also be written to operate as a task that processes a sequence of inputs sent to it. This type of function is known as a <strong>coroutine</strong> and is created by using the <code>yield</code> statement as an expression <code>(yield)</code> as shown in this example:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_matches</span><span class="p">(</span><span class="n">matchtext</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Looking for&quot;</span><span class="p">,</span> <span class="n">matchtext</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span><span class="p">)</span> <span class="c"># Get a line of text</span>
        <span class="k">if</span> <span class="n">matchtext</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">line</span>
</pre></div>


<p>To use this function, you first call it, advance it to the first <code>(yield)</code>, and then start sending data to it using <code>send()</code>. For example:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">matcher</span> <span class="o">=</span> <span class="n">print_matches</span><span class="p">(</span><span class="s">&quot;python&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">matcher</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c"># Advance to the first (yield)</span>
<span class="go">Looking for python</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">matcher</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">matcher</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;python is cool&quot;</span><span class="p">)</span>
<span class="go">python is cool</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">matcher</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;yow!&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">matcher</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># Done with the matcher function call</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>


<p>A coroutine is suspended until a value is sent to it using <code>send()</code>. When this happens, that value is returned by the <code>(yield)</code> expression inside the coroutine and is processed by the statements that follow. Processing continues until the next <code>(yield)</code> expression is encountered, at which point the function suspends. This continues until the coroutine function returns or <code>close()</code> is called on it as shown in the previous example.</p>
<div class="codehilite"><pre><span class="c"># A set of matcher coroutines</span>
<span class="n">matchers</span> <span class="o">=</span> <span class="p">[</span>
<span class="n">print_matches</span><span class="p">(</span><span class="s">&quot;python&quot;</span><span class="p">),</span>
<span class="n">print_matches</span><span class="p">(</span><span class="s">&quot;guido&quot;</span><span class="p">),</span>
<span class="n">print_matches</span><span class="p">(</span><span class="s">&quot;jython&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c"># Prep all of the matchers by calling next()</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matchers</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

<span class="c"># Feed an active log file into all matchers. Note for this to work,</span>
<span class="c"># a web server must be actively writing data to the log.</span>
<span class="n">wwwlog</span> <span class="o">=</span> <span class="n">tail</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;access-log&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wwwlog</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matchers</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="c"># Send data into each matcher coroutine</span>
</pre></div>


<p>Coroutines are detailed in <a href="#functions-and-functional-programming">Chapter 6</a>.</p>
<h3 id="functions-and-functional-programming">Functions and Functional Programming</h3>
<h4 id="decorators">Decorators</h4>
<p>A <strong>decorator</strong> is a function whose primary purpose is to wrap another function or class.  The primary purpose of this wrapping is to transparently alter or enhance the behavior of the object being wrapped. Syntactically, decorators are denoted using the special <code>@</code> symbol as follows:</p>
<div class="codehilite"><pre><span class="nd">@trace</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
</pre></div>


<p>The preceding code is shorthand for the following:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
<span class="n">square</span> <span class="o">=</span> <span class="n">trace</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
</pre></div>


<p>In the example, a function <code>square()</code> is defined. However, immediately after its definition, the function object itself is passed to the function <code>trace()</code>, which returns an object that replaces the original <code>square</code>.</p>
<p>[PER p101]</p>
<h5 id="order-of-multiple-decorators"><strong>Order of multiple decorators</strong> *</h5>
<p>When decorators are used, they must appear on their own line immediately prior to a function or class definition. More than one decorator can also be applied. For example:</p>
<div class="codehilite"><pre><span class="nd">@foo</span>
<span class="nd">@bar</span>
<span class="nd">@spam</span>
<span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>


<p>In this case, the decorators are applied in the order listed.The result is the same as this:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">grok</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">bar</span><span class="p">(</span><span class="n">spam</span><span class="p">(</span><span class="n">grok</span><span class="p">)))</span>
</pre></div>


<h5 id="decorators-with-arguments"><strong>Decorators with arguments</strong> *</h5>
<p>A decorator can also accept arguments. For example:</p>
<div class="codehilite"><pre><span class="nd">@eventhandler</span><span class="p">(</span><span class="s">&#39;BUTTON&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_button</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="c"># ...</span>
<span class="nd">@eventhandler</span><span class="p">(</span><span class="s">&#39;RESET&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_reset</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="c"># ...</span>
</pre></div>


<p>If arguments are supplied, the semantics of the decorator are as follows:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">handle_button</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="c"># ...</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">eventhandler</span><span class="p">(</span><span class="s">&#39;BUTTON&#39;</span><span class="p">)</span> <span class="c"># Call decorator with supplied arguments</span>
<span class="n">handle_button</span> <span class="o">=</span> <span class="n">temp</span><span class="p">(</span><span class="n">handle_button</span><span class="p">)</span> <span class="c"># Call the function returned by the decorato</span>
</pre></div>


<p>In this case, the decorator function only accepts the arguments supplied with the <code>@</code> specifier. It then returns a function that is called with the function as an argument.</p>
<div class="codehilite"><pre><span class="c"># Event handler decorator</span>
<span class="n">event_handlers</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">def</span> <span class="nf">eventhandler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">event_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">register_function</span>
</pre></div>


<p>Decorators can also be applied to class definitions. For example:</p>
<div class="codehilite"><pre><span class="nd">@foo</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># statements</span>
</pre></div>


<p>For class decorators, you should always have the decorator function return a class object as a result. Code that expects to work with the original class definition may want to reference members of the class directly such as <code>Bar.spam</code>. This won’t work correctly if the decorator function <code>foo()</code> returns a function.</p>
<p>Decorators can interact strangely with other aspects of functions such as recursion, documentation strings, and function attributes. These issues are described later in this chapter.</p>
<hr />
<h3 id="references">References</h3>
<ul>
<li>[PER] <em>Python Essential Reference</em> (4th Edition)</li>
</ul>
            </div>
        </div>

        <footer class="col-md-12">
            
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
        <script src="../custom.js"></script>
    </body>
</html>