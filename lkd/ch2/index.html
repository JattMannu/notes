<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/lkd/ch2/">
        <link rel="shortcut icon" href="../../toki_32.png">
        

	<title>Chapter 2. Getting Started with the Kernel - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,400italic,500,600" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">
        <link href="../../friendly.css" rel="stylesheet">
        <link href="../../theme.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../apue/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch3/">Chapter 3. File I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch4/">Chapter 4. Files and Directories</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch5/">Chapter 5. Standard I/O Library</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch6/">Chapter 6. System Data Files and Information</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch7/">Chapter 7. Process Environment</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch8/">Chapter 8. Process Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch9/">Chapter 9. Process Relationships</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch10/">Chapter 10. Signals</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch11/">Chapter 11. Threads</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch12/">Chapter 12. Thread Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch13/">Chapter 13. Daemon Processes</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch14/">Chapter 14. Advanced I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch15/">Chapter 15. Interprocess Communication</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch16/">Chapter 16. Network IPC: Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch17/">Chapter 17. Advanced IPC</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">LKD <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../ch1/">Chapter 1. Introduction to the Linux Kernel</a>
                        </li>
                      
                        <li class="active">
                            <a href="./">Chapter 2. Getting Started with the Kernel</a>
                        </li>
                      
                        <li>
                            <a href="../ch3/">Chapter 3. Process Management</a>
                        </li>
                      
                        <li>
                            <a href="../ch4/">Chapter 4. Process Scheduling</a>
                        </li>
                      
                        <li>
                            <a href="../ch5/">Chapter 5. System Calls</a>
                        </li>
                      
                        <li>
                            <a href="../ch6/">Chapter 6. Kernel Data Structures</a>
                        </li>
                      
                        <li>
                            <a href="../ch7/">Chapter 7. Interrupts and Interrupt Handlers</a>
                        </li>
                      
                        <li>
                            <a href="../ch8/">Chapter 8. Bottom Halves and Deferring Work</a>
                        </li>
                      
                        <li>
                            <a href="../ch9/">Chapter 9. An Introduction to Kernel Synchronization</a>
                        </li>
                      
                        <li>
                            <a href="../ch10/">Chapter 10. Kernel Synchronization Methods</a>
                        </li>
                      
                        <li>
                            <a href="../ch11/">Chapter 11. Timers and Time Management</a>
                        </li>
                      
                        <li>
                            <a href="../ch12/">Chapter 12. Memory Management</a>
                        </li>
                      
                        <li>
                            <a href="../ch13/">Chapter 13. The Virtual Filesystem</a>
                        </li>
                      
                        <li>
                            <a href="../ch14/">Chapter 14. The Block I/O Layer</a>
                        </li>
                      
                        <li>
                            <a href="../ch15/">Chapter 15. The Process Address Space</a>
                        </li>
                      
                        <li>
                            <a href="../ch16/">Chapter 16. The Page Cache and Page Writeback</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../unp/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch3/">Chapter 3. Sockets Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch4/">Chapter 4. Elementary TCP Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch5/">Chapter 5. TCP Client/Server Example</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch6/">Chapter 6. I/O Multiplexing: The select and poll Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch7/">Chapter 7. Socket Options</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch8/">Chapter 8. Elementary UDP Sockets</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TCPv1 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../tcpv1/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch2/">Chapter 2. The Internet Address Architecture</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch3/">Chapter 3. Link Layer</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch4/">Chapter 4. ARP: Address Resolution Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch5/">Chapter 5. The Internet Protocol (IP)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch6/">Chapter 6. System Configuration: DHCP and Autoconfiguration</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch7/">Chapter 7. Firewalls and Network Address Translation (NAT)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch8/">Chapter 8. ICMPv4 and ICMPv6: Internet Control Message Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch9/">Chapter 9. Broadcasting and Local Multicasting (IGMP and MLD)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch10/">Chapter 10. User Datagram Protocol (UDP) and IP Fragmentation</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch11/">Chapter 11. Name Resolution and the Domain Name System (DNS)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch12/">Chapter 12. TCP: The Transmission Control Protocol (Preliminaries)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch13/">Chapter 13. TCP Connection Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch14/">Chapter 14. TCP Timeout and Retransmission</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch15/">Chapter 15. TCP Data Flow and Window Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch16/">Chapter 16. TCP Congestion Control</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch17/">Chapter 17. TCP Keepalive</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch18/">Chapter 18. Security: EAP, IPsec, TLS, DNSSEC, and DKIM</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/headers/">Headers</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">GOPL <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../gopl/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch1/">Chapter 1. Tutorial</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch2/">Chapter 2. Program Structure</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch3/">Chapter 3. Basic Data Types</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch4/">Chapter 4. Composite Types</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch5/">Chapter 5. Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch6/">Chapter 6. Methods</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch7/">Chapter 7. Interfaces</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch10/">Chapter 10. Packages and the Go Tool</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CSN <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../csn/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part1/">Part 1: Language</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part2/">Part 2: Advanced</a>
                        </li>
                      
                    </ul>
                </li>
            <li>
                    <a href="../../toc/">TOC</a>
                </li>
            </ul>
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    
                        <a href="https://github.com/shichao-an/notes/blob/master/docs/lkd/ch2.md">
                    
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-2-getting-started-with-the-kernel">Chapter 2. Getting Started with the Kernel</a></li>
        
    
        <li class="main "><a href="#obtaining-the-kernel-source">Obtaining the Kernel Source</a></li>
        
            <li><a href="#using-git">Using Git</a></li>
        
            <li><a href="#installing-the-kernel-source">Installing the Kernel Source</a></li>
        
            <li><a href="#using-patches">Using Patches</a></li>
        
    
        <li class="main "><a href="#the-kernel-source-tree">The Kernel Source Tree</a></li>
        
    
        <li class="main "><a href="#building-the-kernel">Building the Kernel</a></li>
        
            <li><a href="#configuring-the-kernel">Configuring the Kernel</a></li>
        
            <li><a href="#spawning-multiple-build-jobs">Spawning Multiple Build Jobs</a></li>
        
            <li><a href="#installing-the-new-kernel">Installing the New Kernel</a></li>
        
    
        <li class="main "><a href="#a-beast-of-a-different-nature">A Beast of a Different Nature</a></li>
        
            <li><a href="#no-libc-or-standard-headers">No libc or Standard Headers</a></li>
        
    
        <li class="main "><a href="#gnu-c">GNU C</a></li>
        
            <li><a href="#inline-functions">Inline Functions</a></li>
        
            <li><a href="#inline-assembly">Inline Assembly</a></li>
        
            <li><a href="#branch-annotation">Branch Annotation</a></li>
        
    
        <li class="main "><a href="#no-memory-protection">No Memory Protection</a></li>
        
    
        <li class="main "><a href="#no-easy-use-of-floating-point">No (Easy) Use of Floating Point</a></li>
        
    
        <li class="main "><a href="#small-fixed-size-stack">Small, Fixed-Size Stack</a></li>
        
    
        <li class="main "><a href="#synchronization-and-concurrency">Synchronization and Concurrency</a></li>
        
    
        <li class="main "><a href="#importance-of-portability">Importance of Portability</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
              

<h3 id="chapter-2-getting-started-with-the-kernel"><strong>Chapter 2. Getting Started with the Kernel</strong></h3>
<h3 id="obtaining-the-kernel-source">Obtaining the Kernel Source</h3>
<h4 id="using-git">Using Git</h4>
<div class="codehilite"><pre>$ git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux-2.6.git
</pre></div>


<h4 id="installing-the-kernel-source">Installing the Kernel Source</h4>
<div class="codehilite"><pre>$ tar xvjf linux-x.y.z.tar.bz2
</pre></div>


<h4 id="using-patches">Using Patches</h4>
<p>Throughout the Linux kernel community, patches are the <em>lingua franca</em> of communication. You will distribute your code changes in patches and receive code from others as patches. Incremental patches provide an easy way to move from one kernel tree to the next</p>
<div class="codehilite"><pre>$ patch –p1 &lt; ../patch-x.y.z
</pre></div>


<h3 id="the-kernel-source-tree">The Kernel Source Tree</h3>
<table>
<thead>
<tr>
<th>Directory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>arch</code></td>
<td>Architecture-specific source</td>
</tr>
<tr>
<td><code>block</code></td>
<td>Block I/O layer</td>
</tr>
<tr>
<td><code>crypto</code></td>
<td>Crypto API</td>
</tr>
<tr>
<td><code>Documentation</code></td>
<td>Kernel source documentation</td>
</tr>
<tr>
<td><code>drivers</code></td>
<td>Device drivers</td>
</tr>
<tr>
<td><code>firmware</code></td>
<td>Device firmware needed to use certain drivers</td>
</tr>
<tr>
<td><code>fs</code></td>
<td>The VFS and the individual filesystems</td>
</tr>
<tr>
<td><code>include</code></td>
<td>Kernel headers</td>
</tr>
<tr>
<td><code>init</code></td>
<td>Kernel boot and initialization</td>
</tr>
<tr>
<td><code>ipc</code></td>
<td>Interprocess communication code</td>
</tr>
<tr>
<td><code>kernel</code></td>
<td>Core subsystems, such as the scheduler</td>
</tr>
<tr>
<td><code>lib</code></td>
<td>Helper routines</td>
</tr>
<tr>
<td><code>mm</code></td>
<td>Memory management subsystem and the VM</td>
</tr>
<tr>
<td><code>net</code></td>
<td>Networking subsystem</td>
</tr>
<tr>
<td><code>samples</code></td>
<td>Sample, demonstrative code</td>
</tr>
<tr>
<td><code>scripts</code></td>
<td>Scripts used to build the kernel</td>
</tr>
<tr>
<td><code>security</code></td>
<td>Linux Security Module</td>
</tr>
<tr>
<td><code>sound</code></td>
<td>Sound subsystem</td>
</tr>
<tr>
<td><code>usr</code></td>
<td>Early user-space code (called initramfs)</td>
</tr>
<tr>
<td><code>tools</code></td>
<td>Tools helpful for developing Linux</td>
</tr>
<tr>
<td><code>virt</code></td>
<td>Virtualization infrastructure</td>
</tr>
</tbody>
</table>
<h3 id="building-the-kernel">Building the Kernel</h3>
<h4 id="configuring-the-kernel">Configuring the Kernel</h4>
<div class="codehilite"><pre>$ make config  <span class="c1"># text-based</span>
$ make menuconfig  <span class="c1"># ncurses-based</span>
$ make gconfig  <span class="c1"># gtk+-based</span>
</pre></div>


<p>Creates a configuration based on the defaults for your architecture:</p>
<div class="codehilite"><pre>$ make defconfig
</pre></div>


<p>After making changes to your configuration file, or when using an existing configuration
file on a new kernel tree, you can validate and update the configuration:</p>
<div class="codehilite"><pre>$ make oldconfig
</pre></div>


<p>You should always run this before building a kernel.</p>
<p>After the kernel configuration is set, you can build it with a single command:</p>
<div class="codehilite"><pre>$ make
</pre></div>


<h4 id="spawning-multiple-build-jobs">Spawning Multiple Build Jobs</h4>
<p>To build the kernel with multiple make jobs, use</p>
<div class="codehilite"><pre>$ make -jn
</pre></div>


<p>Here, <em>n</em> is the number of jobs to spawn. </p>
<h4 id="installing-the-new-kernel">Installing the New Kernel</h4>
<p>How it is installed is architecture- and boot loader-dependent.</p>
<p>As an example, on an x86 system using grub, you would copy <code>arch/i386/boot/bzImage</code> to /boot, name it something like vmlinuz-<em>version</em>, and edit <code>/boot/grub/grub.conf</code>, adding a new entry for the new kernel. </p>
<p>Installing modules is automated and architecture-independent. As root, run:</p>
<div class="codehilite"><pre><span class="c">% make modules_install</span>
</pre></div>


<h3 id="a-beast-of-a-different-nature">A Beast of a Different Nature</h3>
<ul>
<li>The kernel has access to neither the C library nor the standard C headers.</li>
<li>The kernel is coded in GNU C.</li>
<li>The kernel lacks the memory protection afforded to user-space.</li>
<li>The kernel cannot easily execute floating-point operations.</li>
<li>The kernel has a small per-process fixed-size stack.</li>
<li>Because the kernel has asynchronous interrupts, is preemptive, and supports SMP, synchronization and concurrency are major concerns within the kernel.</li>
<li>Portability is important.</li>
</ul>
<h4 id="no-libc-or-standard-headers">No libc or Standard Headers</h4>
<p>Unlike a user-space application, the kernel is not linked against the standard C library. The primary reason is speed and size. The full C library—or even a decent subset of it; it is too large and too inefficient for the kernel.</p>
<p>Many of the usual libc functions are implemented inside the kernel. For example, the common string manipulation functions are in <code>lib/string.c</code>. Just include the header file <code>&lt;linux/string.h&gt;</code> and have at them.</p>
<p>A set of architecture-specific header files are located in <code>arch/&lt;architecture&gt;/include/asm</code> in the kernel source tree. For example, if compiling for the x86 architecture, your architecture-specific headers are in <code>arch/x86/include/asm</code>. Source code includes these headers via just the <code>asm/</code> prefix, for example <code>&lt;asm/ioctl.h&gt;</code>.</p>
<h5 id="printk"><code>printk()</code></h5>
<p>Of the missing functions, the most familiar is <code>printf(</code>). The kernel does not have access to <code>printf()</code>, but it does provide <code>printk()</code>, which works pretty much the same as its more familiar cousin. The <code>printk()</code> function copies the formatted string into the kernel log buffer, which is normally read by the syslog program. Usage is similar to <code>printf()</code>:</p>
<div class="codehilite"><pre><span class="n">printk</span><span class="p">(</span><span class="s">&quot;Hello world! A string &#39;%s&#39; and an integer &#39;%d&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</pre></div>


<p>One notable difference is that <code>printk()</code> enables you to specify a priority flag.This flag is used by syslogd to decide where to display kernel messages.</p>
<div class="codehilite"><pre><span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;this is an error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</pre></div>


<p>Note there is no comma between <code>KERN_ERR</code> and the printed message. The priority flag is a preprocessor-define representing a string literal, which is concatenated onto the printed message during compilation.</p>
<h3 id="gnu-c">GNU C</h3>
<p>The kernel is not programmed in strict ANSI C. The kernel developers make use of various language extensions available in <em>gcc</em>. They use both ISO C991 and GNU C extensions to the C language. </p>
<h4 id="inline-functions">Inline Functions</h4>
<p>Both C99 and GNU C support <strong>inline functions</strong>. An inline function is inserted inline into each function call site. This eliminates the overhead of function invocation and return (register saving and restore) and allows for potentially greater optimization as the compiler can optimize both the caller and the called function as one. Kernel developers use inline functions for small time-critical functions.</p>
<p>An inline function is declared when the keywords <code>static</code> and inline are used as part of the function definition. For example</p>
<div class="codehilite"><pre><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">wolf</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tail_size</span><span class="p">)</span>
</pre></div>


<h4 id="inline-assembly">Inline Assembly</h4>
<p>The gcc C compiler enables the embedding of assembly instructions in otherwise normal C functions.</p>
<div class="codehilite"><pre><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">;</span>
<span class="n">asm</span> <span class="nf">volatile</span><span class="p">(</span><span class="s">&quot;rdtsc&quot;</span> <span class="o">:</span> <span class="s">&quot;=a&quot;</span> <span class="p">(</span><span class="n">low</span><span class="p">),</span> <span class="s">&quot;=d&quot;</span> <span class="p">(</span><span class="n">high</span><span class="p">));</span>
<span class="cm">/* low and high now contain the lower and upper 32-bits of the 64-bit tsc */</span>
</pre></div>


<h4 id="branch-annotation">Branch Annotation</h4>
<p>The gcc C compiler has a built-in directive that optimizes conditional branches as either very likely taken or very unlikely taken. The kernel wraps the directive in easy-to-use macros, <code>likely()</code> and <code>unlikely()</code>. </p>
<h3 id="no-memory-protection">No Memory Protection</h3>
<p>When a user-space application attempts an illegal memory access, the kernel can trap the error, send the <code>SIGSEGV</code> signal, and kill the process. If the kernel attempts an illegal memory access, however, the results are less controlled. Memory violations in the kernel result in an <em>oops</em>, which is a major kernel error. </p>
<h3 id="no-easy-use-of-floating-point">No (Easy) Use of Floating Point</h3>
<p>When using floating-point instructions kernel normally catches a trap and then initiates the transition from integer to floating point mode. Unlike user-space, the kernel does not have the luxury of seamless support for floating point because it cannot easily trap itself. Using a floating point inside the kernel requires manually saving and restoring the floating point registers. Except in the rare cases, no floating-point operations are in the kernel.</p>
<h3 id="small-fixed-size-stack">Small, Fixed-Size Stack</h3>
<p>User-space has a large stack that can dynamically grow. </p>
<p>The kernel stack is neither large nor dynamic; it is small and fixed in size. The exact size of the kernel’s stack varies by architecture. On x86, the stack size is configurable at compile-time and can be either 4KB or 8KB.</p>
<h3 id="synchronization-and-concurrency">Synchronization and Concurrency</h3>
<p>A number of properties of the kernel allow for concurrent access of shared resources and thus require synchronization to prevent races.</p>
<ul>
<li>Linux is a preemptive multitasking operating system. Processes are scheduled and rescheduled at the whim of the kernel’s process scheduler.The kernel must synchronize between these tasks.</li>
<li>Linux supports symmetrical multiprocessing (SMP).Therefore, without proper protection, kernel code executing simultaneously on two or more processors can concurrently access the same resource.</li>
<li>Interrupts occur asynchronously with respect to the currently executing code.  Therefore, without proper protection, an interrupt can occur in the midst of accessing a resource, and the interrupt handler can then access the same resource.</li>
<li>The Linux kernel is preemptive. Therefore, without protection, kernel code can be preempted in favor of different code that then accesses the same resource.</li>
</ul>
<p>Typical solutions to race conditions include spinlocks and semaphores.</p>
<h3 id="importance-of-portability">Importance of Portability</h3>
<p>Linux is a portable operating system and should remain one. This means that architecture-independent C code must correctly compile and run on a wide range of systems, and that architecturedependent code must be properly segregated in system-specific directories in the kernel source tree.</p>
            </div>
        </div>

        <footer class="col-md-12">
            
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../custom.js"></script>
    </body>
</html>